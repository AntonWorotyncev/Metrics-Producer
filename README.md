# Metrics-Producer
Микросервис "Metrics Producer",  будет отслеживать и собирать метрики работы приложения, отправляя их в Kafka топик "metrics-topic".
Для успешного запуска сервиса необходимо необходимо:
1. Обратиться к файлу docker-compose.yml и выполнить команду: `docker-compose.yml up` Таким образом  запустятся сервисы
Kafka и Zookeeper. Перед запуском приложения необходимо убедиться, что сервисы стартовали - конфигурация 
не конфликтует и не вызывает проблем.
2. Далее необходимо выполнить запуск приложения Metrics Producer, при необходимоости можно сменить порт веб - сервера на альтернативный:
дополнив файл настроек application.yml следующей командой: `server.port: yourPort`
3. При старте приложения, автоматически создается топик `metrics-topic`, одна партиция и реплика. В него, по средством `POST-запроса` по адресу `/api/metrics-producer/metrics`  сервис 
Metrics Producer будет публиковать метрики, собранные благодаря обращению к данным `Spring Actuator` запущенного приложения. Обращение осуществляется при помощи веб - клиента
   `web.reactive.function.client.WebClient`. Данное решение позволяет асинхронно выполнять несколько запросов к конечным точкам актуатора, что при высоконагруженных определенных условиях, 
может дать положительный эффект в плане отклика системы.

4. Метрики представляют собой набор из двух параметров, исключая идентификатор (id), и временнУю метку (timestamp).
Они включают в себя сведения JVM:
`jvmMemoryMax - максимальная память JVM (в байтах)`
`jvmMemoryUsed - задействованная память JVM (в байтах)`
5. Чтобы отправить метрики  в топик, указанный  ранее, необходимо, перейти на стартовую  страницу  Swagger API, и выбрать 
действие `POST /metrics`. Обращаю внимание на то что метод POST не имеет необходимости передачи тела в качестве параметра. 
В данной реализации он выступает в качестве триггера отправки данных. Подробное описание можно увидеть на странице метода.

**Особенности архитектуры решения:**

Конфигурация Kafka в данном случае ориентирована на пакетную отправку сообщений, поэтому согласно действующим настройкам:

    ` batch-size: 1024  # Устанавливаем максимально возможный размер пакета (пакет - набор сообщений)
      acks: 1 # Гарантия доставки , максимальная надежность
      buffer-memory: 30720000 # Максимальный размер памяти , который может занимать набор пакетов
      linger-ms: 60000 # Ставим задержку в течении которой , будем ожидать наполнения буфера
      max-block-ms: 10000` #Время, на таймаут, в случае, если буфер переполнен.

Обший смысл: После вызова метода post, (возможно даже неоднократно), заполняются пакеты, сообщения копятся в буфере продюсера. 
По истечению таймаута, данные отправляются в топик. Далее запускаем Metrics-Customer , который является отдельным проектом.
